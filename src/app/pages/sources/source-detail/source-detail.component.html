<p-divider align="center" type="dotted">
  <b> Video Analysis </b>
</p-divider>

@if(source?.thumbnail?.url) {
<div style="display: flex; justify-content: center; position: relative">
  <img style="max-width: 600px; border-radius: 20px" [src]="source?.thumbnail?.url" alt="Thumbnail" />

  <div
    style="
      position: absolute;
      top: 15px;
      left: 10%;
      background-color: rgba(0, 0, 0, 0.5);
      color: rgb(251, 180, 0);
      padding: 10px;
      border-radius: 10px;
      font-weight: 700;
    ">
    <h3>{{ source?.name }}</h3>
    <p>tipo: {{ source?.type }}</p>
    <p>Status: {{ source?.status }}</p>
    <p>Status Description: {{ source?.statusDescription }}</p>
  </div>
</div>
}

<div>
  <h5>Status History</h5>
  <ul>
    @for (status of statusHistory; track status) {
    <li>{{ status }}</li>
    }
  </ul>
</div>

@if(!(source?.video) && (source?.type === sourceType.TIKTOK || source?.type === sourceType.YOUTUBE)) {
<div>
  <h5>No hay un video procesado para esta fuente</h5>
  <p-button [loading]="loading.videoProcessing" label="Procesar video" (click)="processVideo()"></p-button>
</div>
} @if(source?.video) {
<div>
  @if(source?.relationId && additionalData){
  <p-divider align="left" type="solid">
    <b>Basic info</b>
  </p-divider>

  <div class="tiktok-summary">
    <h2>{{ additionalData.desc || 'No description' }}</h2>
    <p>By: {{ additionalData.author?.unique_id || 'Unknown username' }} ({{ additionalData.author?.nickname || 'Unknown author' }})</p>

    <div class="stats">
      <span>üëÅÔ∏è {{ additionalData.statistics?.play_count?.toLocaleString() || 0 }} views</span>
      <span>‚ù§Ô∏è {{ additionalData.statistics?.digg_count?.toLocaleString() || 0 }} likes</span>
      <span>üí¨ {{ additionalData.statistics?.comment_count?.toLocaleString() || 0 }} comments</span>
      <span>‚ÜóÔ∏è {{ additionalData.statistics?.share_count?.toLocaleString() || 0 }} shares</span>
    </div>

    <div class="content-info">
      <p>Content Type: {{ additionalData.content_type || 'Unknown' }}</p>
      <p>Shot using: {{ additionalData.shoot_tab_name }}</p>
      @if(additionalData.aigc_info?.aigc_label_type > 0) {
      <p><strong>AI Generated Content</strong></p>
      }
    </div>

    <div class="music-info">
      <h3>Music</h3>
      <p>{{ additionalData.music?.title || 'No music title' }} - {{ additionalData.music?.author || 'Unknown artist' }}</p>
      <p>Volume: {{ additionalData.music_volume ? additionalData.music_volume * 1 : 0 }}%</p>
    </div>
  </div>
  }

  <p-divider align="center" type="dotted">
    <b> Video</b>
  </p-divider>
  <div style="display: flex; justify-content: center">
    <video style="max-width: 600px; border-radius: 15px; border: 1px solid #ccc" [src]="source?.video?.video?.url" controls></video>
  </div>

  <button pButton label="Copy Url" (click)="copyUrl()"></button>
  <!-- <button pButton type="button" label="Download Video" (click)="downloadVideo()"></button> -->

  @if(source?.video?.audio){
  <p-divider align="center" type="dotted">
    <b> Audio</b>
  </p-divider>

  <div style="display: flex; gap: 10px; align-items: center">
    <p-tag icon="pi pi-headphones" value="Original" severity="secondary" />

    <audio [src]="source?.video?.audio?.url" controls></audio>
  </div>
  } @else {
  <div>
    <h5>No audio found</h5>
    <p-button icon="pi pi-user" label="Extract Audio" (click)="extractAudio()"></p-button>
  </div>
  } @if(source?.video?.separatedAudio?.vocals){

  <div style="display: flex; gap: 10px; align-items: center">
    <p-tag icon="pi pi-microphone" value="Vocals" severity="secondary" />
    <audio [src]="source?.video?.separatedAudio?.vocals?.url" controls></audio>
  </div>

  <div style="display: flex; gap: 10px; align-items: center">
    <p-tag icon="pi pi-wave-pulse" value="No Vocals" severity="secondary" />
    <audio [src]="source?.video?.separatedAudio?.no_vocals?.url" controls></audio>
  </div>
  } @else {
  <div>
    <h5>No vocals found</h5>
    <p-button [loading]="loading.extractingVocals" label="Extract Vocals" (click)="extractVocals()"></p-button>
  </div>
  }

  <p-divider align="right" type="dashed">
    <b>Transcription</b>
  </p-divider>

  <h5>Captions</h5>

  <div class="card">
    <p-tabs value="0">
      <p-tablist>
        <p-tab value="0">
          <b style="margin-right: 10px">Whisper Transcription</b>
          <p-tag icon="pi pi-arrow-right" />
        </p-tab>

        <p-tab value="1">
          <b style="margin-right: 10px">Remotion Captions</b>
          <p-tag icon="pi pi-arrow-right" />
        </p-tab>
        <p-tab value="2">
          <b style="margin-right: 10px">Paginated Captions</b>

          <p-tag icon="pi pi-arrow-right" />
        </p-tab>
        <p-tab value="3">
          <b style="margin-right: 10px">Spanish Paginated</b>
        </p-tab>
      </p-tablist>
      <p-tabpanels>
        <p-tabpanel value="0">
          @if(source?.video?.transcription){
          <div>
            <h5>Transcription</h5>
            <strong>Duration: {{ source?.video?.transcription?.duration }} - Language: {{ source?.video?.transcription?.language }}</strong>
            <p>{{ source?.video?.transcription?.text }}</p>

            @if(source?.video?.transcription?.words){
            <div>
              <h5>Words</h5>
              <ul style="max-height: 400px; overflow-y: auto">
                @for(segment of source?.video?.transcription?.words; track segment.id) {
                <li>
                  <b>{{ segment.word }}</b>
                  {{ segment.start | number : '1.2-2' }} - {{ segment.end | number : '1.2-2' }}
                </li>
                }
              </ul>
            </div>

            @if(source?.video?.transcription?.words){
            <div>
              <h5>Transcription words</h5>
            </div>
            } }
          </div>
          } @else {
          <div>
            <h5>No transcription found</h5>
            <p-button label="Extract Transcription" (click)="extractTranscription()"></p-button>
          </div>
          }

        </p-tabpanel>
        <p-tabpanel value="1">
          <p class="m-0">
            @if(source?.video?.captions?.remotion){
            <div>
              <h5>Remotion Captions</h5>
              <ul>
                @for(caption of source?.video?.captions?.remotion; track caption) {
                <li>
                  <b>{{ caption.text }}</b>
                  {{ caption.startMs | number : '1.2-2' }} - {{ caption.endMs | number : '1.2-2' }}
                </li>
                }
              </ul>
            </div>
            } @else {
            <div>
              <h5>No remotion captions found</h5>
              <p-button label="Extract Remotion Captions" (click)="extractRemotionCaptions()" variant="outlined"></p-button>
            </div>
            }

          </p>

        </p-tabpanel>
        <p-tabpanel value="2">
          <p class="m-0">
            @if(source?.video?.captions?.tiktokStyle){
            <div>
              <h5>Paginated Captions</h5>
              @for(page of source?.video?.captions?.tiktokStyle; track page) {
                <ul>
                  <li>
                    <b>{{ page.text }}</b>
                    <br>
                    @for(token of page.tokens; track token) {
                    <span> <i>{{ token.text }}</i> {{ token.fromMs }} - {{ token.toMs }} </span>
                    }
                  </li>
                </ul>
              }
            </div>
            } 
            @else {
            <div>
              <h5>No paginated captions found</h5>
          <p-button label="Extract paginated captions" (click)="extractTiktokStylePaginatedCaptions()" variant="outlined"></p-button>
            </div>
            }
          </p>
        </p-tabpanel>

                <p-tabpanel value="3">
          <p class="m-0">
            @if(source?.video?.captions?.tiktokStyleSpanish){
            <div>
              <h5>Spanish Paginated Captions</h5>
              @for(page of source?.video?.captions?.tiktokStyleSpanish; track page) {
                <ul>
                  <li>
                    <b>{{ page.text }}</b>
                    <br>
                    @for(token of page.tokens; track token) {
                    <span> <i>{{ token.text }}</i> {{ token.fromMs }} - {{ token.toMs }} </span>
                    }
                  </li>
                </ul>
              }
            </div>
            } 
            @else {
            <div>
              <h5>No spanish paginated captions found</h5>
          <p-button label="Translate tiktok style to spanish" (click)="translateTiktokStylePaginatedCaptions()" variant="outlined"></p-button>
            </div>
            }
          </p>
        </p-tabpanel>
      </p-tabpanels>
    </p-tabs>
  </div>


   @if (source?.video?.frames) {
  <div>
    <h5>Frames</h5>
    <div style="display: flex; flex-wrap: wrap; gap: 10px">
      @for(frame of source?.video?.frames; track frame) {
      <img class="frame-image" [src]="frame?.image?.url" />
      }
    </div>
  </div>
  } @else {
  <div>
    <h5>No frames found</h5>
    <p-button label="Extract Frames" (click)="extractFrames()"></p-button>
  </div>
  }
</div>
}

<!-- <dc-progress-toast [visible]="isToastVisible" [progress]="toastProgress" (processCompleted)="onProcessCompleted()" (processClosed)="onProcessClosed()"></dc-progress-toast> -->