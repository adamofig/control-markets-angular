<div class="details-container p-4">
  <form [formGroup]="form">

    <div class="field mb-4">
      <label for="prompt" class="block font-bold mb-2">Generation Prompt (Optional)</label>
      <textarea
        id="prompt"
        pInputTextarea
        formControlName="prompt"
        rows="1"
        class="w-full"
        placeholder="Add extra instructions or context for the AI script generation..."
      ></textarea>
      <small class="text-secondary">This prompt is combined with content from all connected input nodes.</small>
    </div>

    @if (hasAudioTtsInput) {
      <div class="field mb-4 flex align-items-center gap-2 p-3 border-round surface-100 border-1 border-primary-100">
        <i class="pi pi-megaphone text-primary" style="font-size: 1.5rem"></i>
        <div class="flex-grow-1">
          <label for="useAudioTts" class="block font-bold">Automatic Audio Generation</label>
          <small class="text-secondary">Enable this to use settings from the connected TTS node to generate speech for each dialog line.</small>
        </div>
        <p-toggleSwitch id="useAudioTts" formControlName="useAudioTts"></p-toggleSwitch>
      </div>
    }



    <div class="dialogs-section mb-4">
        <h3 class="font-bold mb-2">Dialogs</h3>
        <app-dialogs [arrayForm]="dialogsFormArray" [dialogs]="node?.data?.nodeData?.dialogs"></app-dialogs>
    </div>

    @if (inputNodes.length > 0) {
      <div class="inputs-section mb-4">
        <h3 class="font-bold mb-2">Input Contents</h3>
        <div class="flex flex-column gap-3">
          @for (inputNode of inputNodes; track inputNode.id) {
            <div class="input-item p-3 border-round surface-100">
              <div class="font-bold mb-1 flex align-items-center gap-2">
                <i [class]="inputNode.config?.icon"></i>
                {{ inputNode.config?.label || 'Input' }}
              </div>
              <div class="text-sm line-height-3 white-space-pre-wrap">
                {{ getInputContent(inputNode) || 'No content available' }}
              </div>
            </div>
          }
        </div>
      </div>
    }

    <div class="flex justify-content-end gap-2 mt-4">
      <p-button label="Cancel" icon="pi pi-times" severity="secondary" (onClick)="cancel()"></p-button>
      @if (hasAudioTtsInput) {
        <p-button 
          label="Generate Audios" 
          icon="pi pi-volume-up" 
          severity="info" 
          [loading]="isGeneratingAudio" 
          (onClick)="generateAudio()"
          [disabled]="isGeneratingAudio || isLoading"
        ></p-button>
      }
      <p-button 
        label="Generate Script" 
        icon="pi pi-sparkles" 
        severity="help" 
        [loading]="isLoading" 
        (onClick)="generateScript()"
        [disabled]="isLoading || isGeneratingAudio || !hasInputContent"
      ></p-button>
      <p-button label="Save" icon="pi pi-check" (onClick)="save()" [disabled]="isLoading || isGeneratingAudio"></p-button>
    </div>
  </form>
</div>
