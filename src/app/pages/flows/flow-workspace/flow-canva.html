<!-- <vflow view="auto" [nodes]="nodes" [background]="backDots" /> -->

<div style="display: flex; align-items: center; gap: 10px">
  <input
    placeholder="Escribe el nombre del flujo"
    type="text"
    pInputText
    [(ngModel)]="flowName"
    pSize="small"
    style="
      background-color: transparent !important;

      border-radius: 40px;
      border: none;
      outline: none;
      font-size: 12px;
      font-weight: bold;
      width: 200px;
    " />

  <p-button (click)="showDialog('isAgentVisible')" label="Add Agent" icon="pi pi-user" [rounded]="true" severity="success" [outlined]="true" />
  <p-button (click)="showDialog('isAssetVisible')" label="Add Asset" icon="pi pi-user" [rounded]="true" severity="success" [outlined]="true" />
  <p-button (click)="addVideoGenNode()" label="Add Video" icon="pi pi-user" [rounded]="true" severity="success" [outlined]="true" />

  <p-button (click)="showDialog('isTaskVisible')" icon="pi pi-plus" label="Add Task" [rounded]="true" severity="warn" [outlined]="true" />
  <p-button icon="pi pi-heart" label="Add Distribution Channel" [rounded]="true" severity="help" [outlined]="true" (click)="addDistributionNode()" />
  <p-button (click)="addSourceNode()" icon="pi pi-file-import" label="Add Source" [rounded]="true" severity="info" [outlined]="true" />

  <p-button (click)="saveFlow()" label="Save Flow" icon="pi pi-save" [rounded]="true" severity="secondary" [outlined]="true" [loading]="isSavingFlow()" />
  <p-button icon="pi pi-play" label="Run Flow" (click)="runFlow()" [rounded]="true" severity="primary" [outlined]="true" [loading]="isRunningFlow()" />
</div>

<!-- Hidden file input for adding sources -->
<input type="file" #sourceFileInput (change)="onSourceFileSelected($event)" accept=".md" style="display: none" />

<vflow view="auto" [nodes]="flowDiagramStateService.nodes()" [edges]="flowDiagramStateService.edges()" [background]="backDots" (onConnect)="createEdge($event)">
  <ng-template let-ctx nodeHtml>
    <div class="custom-node" selectable [class.custom-node_selected]="ctx.selected()">
      <img style="position: absolute; top: 0; left: 0" [src]="ctx.node.data().image" alt="" />
      <p class="text-node">{{ ctx.node.data().text }}</p>

      <handle type="source" position="top" id="a" />
      <handle type="source" position="right" id="b" />
      <handle type="source" position="bottom" id="c" />
      <handle type="source" position="left" id="d" />
    </div>
  </ng-template>

  <ng-template let-ctx edgeLabelHtml>
    <p-button icon="pi pi-times" (click)="flowDiagramStateService.deleteEdge(ctx.edge)" [rounded]="true" [text]="true" severity="danger" />
  </ng-template>
</vflow>

<p-dialog header="Agregar Entidad" [draggable]="false" [(visible)]="isDialogVisible" [modal]="true" [style]="{ width: '85%', height: '85%' }">
  @if(dialogs.isAgentVisible) {
  <dc-agent-card-lists (onAction)="addAgentToFlow($event)" />
  } @if(dialogs.isTaskVisible) {
  <p>Entidad.</p>
  <app-task-list viewMode="table" (onSelect)="addTaskToFlow($event)" />
  } @if(dialogs.isAssetVisible) {
  <app-assets-uploads (imageUploaded)="addAssetToFlow($event)"></app-assets-uploads>
  }
</p-dialog>
