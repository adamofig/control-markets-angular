<div style="display: flex; align-items: center; gap: 10px; position: absolute; top: 10px; right: 10px">
  <input
    placeholder="Escribe el nombre del flujo"
    type="text"
    pInputText
    [(ngModel)]="flowName"
    pSize="small"
    style="
      background-color: transparent !important;

      border-radius: 40px;
      border: none;
      outline: none;
      font-size: 12px;
      font-weight: bold;
      width: 200px;
    " />

  <p-button (click)="showDialog('isAgentVisible')" label="Agent" icon="pi pi-user-plus" [rounded]="true" severity="success" [outlined]="true" />
  <p-button (click)="showDialog('isAssetVisible')" label="Asset" icon="pi pi-plus-circle" [rounded]="true" severity="success" [outlined]="true" />
  <p-button (click)="showDialog('isSourceVisible')" icon="pi pi-file-import" label="Source" [rounded]="true" severity="success" [outlined]="true" />

  <!-- Process -->
  <p-button (click)="addVideoGenNode()" label="Video" icon="pi pi-video" [rounded]="true" severity="warn" [outlined]="true" />
  <p-button (click)="showDialog('isTaskVisible')" icon="pi pi-microchip-ai" label="Task" [rounded]="true" severity="warn" [outlined]="true" />
  <!-- Other -->

  <p-button (click)="addAudioTTSGenNode()" icon="pi pi-megaphone" label="Audio" [rounded]="true" severity="warn" [outlined]="true" />

  <!-- <p-button icon="pi pi-heart" label="Distribution Channel" [rounded]="true" severity="help" [outlined]="true" (click)="addDistributionNode()" /> -->

  <p-button (click)="saveFlow()" label="Save Flow" icon="pi pi-save" [rounded]="true" severity="secondary" [outlined]="true" [loading]="isSavingFlow()" />
  <p-button icon="pi pi-play" label="Run Flow" (click)="runFlow()" [rounded]="true" severity="primary" [outlined]="true" [loading]="isRunningFlow()" />
</div>

<app-comfy-status style="position: absolute; bottom: 10px; left: 10px" />

<vflow view="auto" [nodes]="flowDiagramStateService.nodes()" [edges]="flowDiagramStateService.edges()" [background]="backDots" (onConnect)="createEdge($event)">
  <ng-template let-ctx nodeHtml>
    <div class="custom-node" selectable [class.custom-node_selected]="ctx.selected()">
      <img style="position: absolute; top: 0; left: 0" [src]="ctx.node.data().image" alt="" />
      <p class="text-node">{{ ctx.node.data().text }}</p>

      <handle type="source" position="top" id="a" />
      <handle type="source" position="right" id="b" />
      <handle type="source" position="bottom" id="c" />
      <handle type="source" position="left" id="d" />
    </div>
  </ng-template>

  <ng-template let-ctx edgeLabelHtml>
    <p-button icon="pi pi-times" (click)="flowDiagramStateService.deleteEdge(ctx.edge)" [rounded]="true" [text]="true" severity="danger" />
  </ng-template>
</vflow>

<div style="position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px">
  <!-- Show options to add agents Assets and Source -->
  <p-speeddial [model]="resourceItems" direction="up" [tooltipOptions]="{ tooltipPosition: 'left' }">
    <ng-template #button let-toggleCallback="toggleCallback">
      <p-button severity="success" [outlined]="true" [rounded]="true" (click)="toggleCallback($event)" pTooltip="Add Resource" tooltipPosition="top">
        <i class="pi pi-paperclip"></i>
      </p-button>
    </ng-template>
  </p-speeddial>

  <p-speeddial
    [model]="processItems"
    direction="up"
    [style]="{ position: 'absolute', right: 'calc(50% - 5rem)'}"
    [tooltipOptions]="{ tooltipPosition: 'right' }">
    <ng-template #button let-toggleCallback="toggleCallback">
      <p-button severity="warn" [outlined]="true" [rounded]="true" (click)="toggleCallback($event)" pTooltip="Add Process">
        <i class="pi pi-microchip"></i>
      </p-button>
    </ng-template>
  </p-speeddial>
</div>

<p-dialog header="Agregar Recursos Multimedia" [draggable]="false" [(visible)]="isDialogVisible" [modal]="true" [style]="{ width: '85%', height: '85%' }">
  @if(dialogs.isAgentVisible) {
  <dc-agent-card-lists (onAction)="addAgentToFlow($event)" />
  } @if(dialogs.isTaskVisible) {
  <p>Entidad.</p>
  <app-task-list viewMode="table" (onSelect)="addTaskToFlow($event)" />
  } @if(dialogs.isAssetVisible) {
  <app-assets-uploads (imageUploaded)="addAssetToFlow($event)"></app-assets-uploads>
  } @if(dialogs.isSourceVisible) {
  <app-sources-uploads (sourceUploaded)="addSourceToFlow($event)"></app-sources-uploads>
  }
</p-dialog>
