<ion-app>
  <ion-split-pane contentId="main-content">
    <!-- LEFT SIDE MENU -->
    <ion-menu contentId="main-content" type="overlay">
      <ion-content>
        <ion-list id="inbox-list">
          <ion-list-header class="project-title"> {{ projectName }}</ion-list-header>

          @for (p of appPages; track p; let i = $index) {
          <ion-menu-toggle auto-hide="false">
            <ion-item routerDirection="root" [routerLink]="[p.url]" lines="none" detail="false" routerLinkActive="selected">
              <ion-icon aria-hidden="true" slot="start" [ios]="p.icon + '-outline'" [md]="p.icon + '-sharp'" />
              <ion-label>{{ p.title }}</ion-label>
            </ion-item>
          </ion-menu-toggle>
          }

          <!-- Admin Section -->
          @if (isAdmin) {
          <ion-list-header>Admin Section</ion-list-header>
          @for (p of adminPages; track p; let i = $index) {
          <ion-menu-toggle auto-hide="false">
            <ion-item routerDirection="root" [routerLink]="[p.url]" lines="none" detail="false" routerLinkActive="selected">
              <ion-icon aria-hidden="true" slot="start" [ios]="p.icon + '-outline'" [md]="p.icon + '-sharp'" />
              <ion-label>{{ p.title }}</ion-label>
            </ion-item>
          </ion-menu-toggle>
          } }
        </ion-list>
      </ion-content>

      <ion-footer>
        <ion-toolbar>
          <ion-note style="padding-left: 10px">{{ envName }} - v{{ version }}</ion-note>
        </ion-toolbar>
      </ion-footer>
    </ion-menu>

    <!-- TOP BAR  -->
    <div class="ion-page" id="main-content">
      <ion-header [translucent]="true">
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="toggleMenu()">
              <ion-icon [name]="menuVisible ? 'menu-outline' : 'menu'" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title class="project-title"> {{ projectName }}</ion-title>

          <ion-buttons slot="end">
            <app-pwa-install />

            <p-toggleswitch [(ngModel)]="isDarkMode" (onChange)="toggleDarkMode()">
              <ng-template #handle let-checked="checked">
                <i [class]="['!text-xs', 'pi', checked ? 'pi-moon' : 'pi-sun']"></i>
              </ng-template>
            </p-toggleswitch>

            <ion-button (click)="openActionSheet()">
              <span>
                <ion-avatar style="width: 3em; height: 3em; position: relative">
                  @if(userService.isAdmin()) {
                  <i style="right: -2px; top: -2px; position: absolute; color: rgb(255, 149, 0)" class="pi pi-key"></i>
                  }

                  <i
                    style="left: -6px; bottom: 4px; position: absolute; color: rgb(255, 149, 0)"
                    [class]="userService.user()?.claims?.plan?.type | planIcon"></i>

                  <img width="10px" alt="Silhouette of a person's head" [src]="user?.urlPicture || '/assets/defaults/icons/default-avatar.png'" />
                </ion-avatar>
              </span>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <router-outlet></router-outlet>
      </ion-content>

      <ion-tab-bar slot="bottom">
        <ion-tab-button id="home-tab" tab="home" (click)="navigateTo('page/home')">
          <ion-icon name="home"></ion-icon>
          Home
        </ion-tab-button>

        <ion-tab-button tab="flows" (click)="navigateTo('page/flows')">
          <ion-icon name="git-compare"></ion-icon>
          Flujos
        </ion-tab-button>

        <ion-tab-button tab="agents" (click)="navigateTo('page/agents')">
          <ion-icon name="id-card"></ion-icon>
          Agentes
        </ion-tab-button>

        <ion-tab-button tab="taks" (click)="navigateTo('page/tasks')">
          <ion-icon name="barbell"></ion-icon>
          Tareas
        </ion-tab-button>

        <ion-tab-button tab="jobs" (click)="navigateTo('page/jobs')">
          <ion-icon name="document-text"></ion-icon>
          Resultados
        </ion-tab-button>

        <ion-tab-button tab="sources" (click)="navigateTo('page/sources')">
          <ion-icon name="document-attach"></ion-icon>
          Fuentes
        </ion-tab-button>

        <ion-tab-button tab="sources" (click)="navigateTo('page/video-analizer')">
          <ion-icon name="analytics"></ion-icon>
          V. Analisis
        </ion-tab-button>

        <ion-tab-button tab="sources" (click)="navigateTo('page/video-generator')">
          <ion-icon name="videocam"></ion-icon>
          V. Proyectos
        </ion-tab-button>
      </ion-tab-bar>
    </div>
  </ion-split-pane>
</ion-app>
